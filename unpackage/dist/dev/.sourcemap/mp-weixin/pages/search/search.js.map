{"version":3,"file":"search.js","sources":["pages/search/search.vue","../../../HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n\t<view class=\"searchLayout\">\n\t\t<view class=\"search\">\n\t\t\t<uni-search-bar \n\t\t\t@confirm=\"onSearch\"\n\t\t\t@cancel=\"onClear\"\n\t\t\t@clear=\"onClear\"\n\t\t\tfocus \n\t\t\tplaceholder=\"搜索\"\n\t\t\tv-model=\"queryParams.keyword\">\n\t\t\t</uni-search-bar>\n\t\t</view>\n\t\t\n\t\t\n\t\t<view v-if=\"!classList.length || noSearch\">\n\t\t\t<view class=\"history\" v-if=\"historySearch.length\">\n\t\t\t\t<view class=\"topTitle\">\n\t\t\t\t\t<view class=\"text\">最近搜索</view>\n\t\t\t\t\t<view class=\"icon\" @click=\"removeHistory\">\n\t\t\t\t\t\t<uni-icons type=\"trash\" size=\"25\"></uni-icons>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tabs\">\n\t\t\t\t\t<view class=\"tab\" v-for=\"tab in historySearch\" :key=\"tab\" @click=\"clickTab(tab)\">{{tab}}</view>\t\t\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"recommend\">\n\t\t\t\t<view class=\"topTitle\">\n\t\t\t\t\t<view class=\"text\">热门搜索</view>\t\t\t\t\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tabs\">\t\t\t\t\n\t\t\t\t\t<view class=\"tab\" v-for=\"tab in recommendList\" :key=\"tab\" @click=\"clickTab(tab)\">{{tab}}</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t\n\t\t<view class=\"noSearch\" v-if=\"noSearch\">\n\t\t\t<uv-empty mode=\"search\" icon=\"http://cdn.uviewui.com/uview/empty/search.png\"></uv-empty>\n\t\t</view>\n\t\t\n\t\t\n\t\t<view v-else>\n\t\t\t<view class=\"list\">\n\t\t\t\t<navigator :url=\"`/pages/preview/preview?id=${item._id}`\"  class=\"item\" \n\t\t\t\tv-for=\"item in classList\" :key=\"item._id\">\t\t\t\t\n\t\t\t\t\t<image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\t\t\t\t\n\t\t\t\t</navigator>\n\t\t\t</view>\t\t\n\t\t\t<view v-if=\"noData || classList.length\"><uni-load-more :status=\"noData?'noMore':'loading'\"/></view>\n\t\t</view>\n\t\t<view class=\"safe-area-inset-bottom\"></view>\n\t\t\n\t</view>\n</template>\n\n<script setup>\nimport {ref} from \"vue\";\nimport {onLoad,onUnload,onReachBottom} from \"@dcloudio/uni-app\";\nimport {apiSearchWall} from '@/api/apis.js'\n//查询参数\nconst queryParams = ref({\t\n\tpageNum:1,\n\tpageSize:12,\n\tkeyword:\"\"\n})\n\n//搜索历史词\nconst historySearch = ref(uni.getStorageSync('historySearch') || [])\n\n//热门搜索词\nconst recommendList = ref([\"美女\",\"帅哥\",\"宠物\",\"卡通\"]);\n\n//没有更多\nconst noData = ref(false);\n//没有搜索结果\nconst noSearch = ref(false);\n\n//搜索结果列表\nconst classList = ref([]);\n\n\n//点击搜索\nconst onSearch = ()=>{\r\n\tuni.showLoading()\r\n\tinitParams(queryParams.value.keyword)\r\n\t// 修改历史搜索记录\n\thistorySearch.value = [...new Set([queryParams.value.keyword,...historySearch.value])].slice(0,10)\r\n\tuni.setStorageSync('historySearch',historySearch.value)\r\n\tsearchWall()\n}\n\n//点击清除按钮\nconst onClear = ()=>{\n\tinitParams()\n}\n\n\n\n//点击标签进行搜索\nconst clickTab = (value)=>{\r\n\tinitParams(value)\r\n\tonSearch()\n}\n\n\n//点击清空搜索记录\nconst removeHistory = ()=>{\n\tuni.showModal({\n\t\ttitle:\"是否清空历史搜索？\",\n\t\tsuccess:res=>{\n\t\t\tif(res.confirm){\r\n\t\t\t\tuni.removeStorageSync('historySearch')\r\n\t\t\t\thistorySearch.value = []\n\t\t\t}\n\t\t}\n\t})\n}\n\n//触底加载更多\nonReachBottom(()=>{\r\n\tif(noData.value) return;\n\tqueryParams.value.pageNum++;\r\n\tsearchWall()\n})\n\n//关闭有页面\nonUnload(()=>{\r\n\tconsole.log('remove');\n\tuni.removeStorageSync('picList')\n})\n\n\r\n// 搜索\r\nconst searchWall = async() =>{\r\n\ttry{\r\n\t\tlet result = await apiSearchWall(queryParams.value)\r\n\t\tclassList.value = [...classList.value,...result.data]\r\n\t\tuni.setStorageSync('picList',classList.value)\r\n\t\t// 当前的收到的数据已经是最后的数据\r\n\t\tif(queryParams.value.pageSize != result.data.length) noData.value = true\r\n\t\t// 没有搜索结果\r\n\t\tif(classList.value.length == 0 && result.data.length == 0) noSearch.value = true\r\n\t\tconsole.log(result);\r\n\t}finally{\r\n\t\tuni.hideLoading()\r\n\t}\r\n\t\r\n}\r\n\r\n\r\n// 初始化参数\r\nconst initParams = (value='') =>{\r\n\tqueryParams.value.pageNum = 1\r\n\tqueryParams.value.pageSize = 12\r\n\tqueryParams.value.keyword = value\r\n\tclassList.value = []\r\n\tnoData.value = false\r\n\tnoSearch.value = false\r\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.searchLayout{\n\t.search{\n\t\tpadding:0 10rpx;\n\t}\n\t.topTitle{\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tfont-size: 32rpx;\n\t\tcolor:#999;\n\t}\n\t.history{\n\t\tpadding:30rpx;\t\t\n\t}\n\t.recommend{\n\t\tpadding:30rpx;\n\t}\n\t.tabs{\n\t\tdisplay: flex;\t\t\n\t\talign-items: center;\n\t\tflex-wrap: wrap;\n\t\tpadding-top:20rpx;\n\t\t.tab{\n\t\t\tbackground: #F4F4F4;\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor:#333;\n\t\t\tpadding:10rpx 28rpx;\n\t\t\tborder-radius: 50rpx;\n\t\t\tmargin-right: 20rpx;\n\t\t\tmargin-top: 20rpx;\n\t\t}\n\t}\t\n\t.list{\n\t\tdisplay: grid;\n\t\tgrid-template-columns: repeat(3,1fr);\n\t\tgap: 5rpx;\n\t\tpadding:20rpx 5rpx;\t\t\n\t\t.item{\n\t\t\theight: 440rpx;\n\t\t\timage{\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: block;\n\t\t\t}\t\t\t\n\t\t}\t\t\n\t}\n}\n</style>\n","import MiniProgramPage from 'D:/前端学习/前端项目/wallpaper/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onReachBottom","onUnload","apiSearchWall"],"mappings":";;;;;;;;;;;;;;;;;;;;AA8DA,UAAM,cAAcA,cAAAA,IAAI;AAAA,MACvB,SAAQ;AAAA,MACR,UAAS;AAAA,MACT,SAAQ;AAAA,IACT,CAAC;AAGD,UAAM,gBAAgBA,cAAG,IAACC,cAAG,MAAC,eAAe,eAAe,KAAK,CAAA,CAAE;AAGnE,UAAM,gBAAgBD,cAAG,IAAC,CAAC,MAAK,MAAK,MAAK,IAAI,CAAC;AAG/C,UAAM,SAASA,cAAAA,IAAI,KAAK;AAExB,UAAM,WAAWA,cAAAA,IAAI,KAAK;AAG1B,UAAM,YAAYA,cAAAA,IAAI,CAAA,CAAE;AAIxB,UAAM,WAAW,MAAI;AACpBC,oBAAAA,MAAI,YAAa;AACjB,iBAAW,YAAY,MAAM,OAAO;AAEpC,oBAAc,QAAQ,CAAC,GAAG,oBAAI,IAAI,CAAC,YAAY,MAAM,SAAQ,GAAG,cAAc,KAAK,CAAC,CAAC,EAAE,MAAM,GAAE,EAAE;AACjGA,oBAAAA,MAAI,eAAe,iBAAgB,cAAc,KAAK;AACtD,iBAAY;AAAA,IACb;AAGA,UAAM,UAAU,MAAI;AACnB,iBAAY;AAAA,IACb;AAKA,UAAM,WAAW,CAAC,UAAQ;AACzB,iBAAW,KAAK;AAChB,eAAU;AAAA,IACX;AAIA,UAAM,gBAAgB,MAAI;AACzBA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAM;AAAA,QACN,SAAQ,SAAK;AACZ,cAAG,IAAI,SAAQ;AACdA,0BAAG,MAAC,kBAAkB,eAAe;AACrC,0BAAc,QAAQ,CAAE;AAAA,UACxB;AAAA,QACD;AAAA,MACH,CAAE;AAAA,IACF;AAGAC,kBAAAA,cAAc,MAAI;AACjB,UAAG,OAAO;AAAO;AACjB,kBAAY,MAAM;AAClB,iBAAY;AAAA,IACb,CAAC;AAGDC,kBAAAA,SAAS,MAAI;AACZF,oBAAAA,MAAA,MAAA,OAAA,kCAAY,QAAQ;AACpBA,oBAAG,MAAC,kBAAkB,SAAS;AAAA,IAChC,CAAC;AAID,UAAM,aAAa,YAAU;AAC5B,UAAG;AACF,YAAI,SAAS,MAAMG,uBAAc,YAAY,KAAK;AAClD,kBAAU,QAAQ,CAAC,GAAG,UAAU,OAAM,GAAG,OAAO,IAAI;AACpDH,sBAAAA,MAAI,eAAe,WAAU,UAAU,KAAK;AAE5C,YAAG,YAAY,MAAM,YAAY,OAAO,KAAK;AAAQ,iBAAO,QAAQ;AAEpE,YAAG,UAAU,MAAM,UAAU,KAAK,OAAO,KAAK,UAAU;AAAG,mBAAS,QAAQ;AAC5EA,sBAAAA,MAAY,MAAA,OAAA,kCAAA,MAAM;AAAA,MACpB,UAAE;AACAA,sBAAAA,MAAI,YAAa;AAAA,MACjB;AAAA,IAEF;AAIA,UAAM,aAAa,CAAC,QAAM,OAAM;AAC/B,kBAAY,MAAM,UAAU;AAC5B,kBAAY,MAAM,WAAW;AAC7B,kBAAY,MAAM,UAAU;AAC5B,gBAAU,QAAQ,CAAE;AACpB,aAAO,QAAQ;AACf,eAAS,QAAQ;AAAA,IAClB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/JA,GAAG,WAAW,eAAe;"}